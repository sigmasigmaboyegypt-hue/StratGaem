<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>NationCraft Ultimate - Historical Country Builder</title>
    <style>
        :root {
            --bg-primary: #0a0f1c;
            --bg-secondary: #131a2d;
            --bg-card: #1a2238;
            --accent-primary: #3a86ff;
            --accent-secondary: #8338ec;
            --accent-success: #38b000;
            --accent-warning: #ff9e00;
            --accent-danger: #ff006e;
            --accent-info: #00bbf9;
            --text-primary: #ffffff;
            --text-secondary: #b0b8d1;
            --text-muted: #6b7280;
            --border-radius: 12px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 16px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Enhanced Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .header-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Enhanced Game Layout */
        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 16px;
            min-height: 80vh;
        }

        /* Enhanced Sidebars */
        .sidebar {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: sticky;
            top: 16px;
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Enhanced Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Enhanced Tabs System */
        .tab-system {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .tab-header {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-button {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .tab-button.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
            background: rgba(58, 134, 255, 0.1);
        }

        .tab-content {
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Enhanced Visual Elements */
        .crisis-alert {
            background: linear-gradient(135deg, var(--accent-danger), #ff2e8b);
            color: white;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            animation: pulse 2s infinite;
            border-left: 5px solid #ff006e;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .environment-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .environment-indicator.critical {
            background: rgba(255, 0, 110, 0.2);
            border-left: 3px solid var(--accent-danger);
        }

        .environment-indicator.warning {
            background: rgba(255, 158, 0, 0.2);
            border-left: 3px solid var(--accent-warning);
        }

        .environment-indicator.good {
            background: rgba(56, 176, 0, 0.2);
            border-left: 3px solid var(--accent-success);
        }

        /* Enhanced Progress Bars */
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Enhanced Charts */
        .population-chart {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 12px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .chart-label {
            width: 100px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .chart-value {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Enhanced Research Tree */
        .tech-tree {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .tech-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 16px;
            border: 2px solid transparent;
            transition: var(--transition);
            cursor: pointer;
        }

        .tech-card.researched {
            border-color: var(--accent-success);
            background: rgba(56, 176, 0, 0.1);
        }

        .tech-card.available {
            border-color: var(--accent-primary);
            background: rgba(58, 134, 255, 0.1);
        }

        .tech-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tech-cost {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Enhanced War System */
        .war-interface {
            background: rgba(255, 0, 110, 0.1);
            border: 1px solid rgba(255, 0, 110, 0.3);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
        }

        .battle-animation {
            height: 100px;
            background: linear-gradient(45deg, #ff006e, #ff2e8b);
            border-radius: var(--border-radius);
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .battle-unit {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: battleMove 2s infinite alternate;
        }

        @keyframes battleMove {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(300%) translateY(200%); }
        }

        /* Enhanced Economy Dashboard */
        .economic-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .economic-indicator {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 12px;
            text-align: center;
        }

        .economic-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 4px;
        }

        .economic-trend {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .trend-up { color: var(--accent-success); }
        .trend-down { color: var(--accent-danger); }

        /* Enhanced Espionage System */
        .espionage-missions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .mission-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 16px;
            border-left: 4px solid var(--accent-info);
        }

        .mission-risk {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .risk-low { background: rgba(56, 176, 0, 0.3); color: var(--accent-success); }
        .risk-medium { background: rgba(255, 158, 0, 0.3); color: var(--accent-warning); }
        .risk-high { background: rgba(255, 0, 110, 0.3); color: var(--accent-danger); }

        /* Enhanced Scenario System */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .scenario-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
        }

        .scenario-difficulty {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .difficulty-easy { background: rgba(56, 176, 0, 0.3); color: var(--accent-success); }
        .difficulty-medium { background: rgba(255, 158, 0, 0.3); color: var(--accent-warning); }
        .difficulty-hard { background: rgba(255, 0, 110, 0.3); color: var(--accent-danger); }

        /* Enhanced Sound Controls */
        .sound-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .sound-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Performance Monitor */
        .performance-monitor {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: var(--accent-success);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-family: monospace;
            z-index: 1000;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 768px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                max-height: none;
            }
            
            .tab-header {
                flex-wrap: wrap;
            }
            
            .tab-button {
                flex: 1;
                min-width: 120px;
            }
        }

        /* Enhanced Button Styles */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(58, 134, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        /* Enhanced Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: var(--accent-success);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1500;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--accent-danger);
        }

        .notification.warning {
            background: var(--accent-warning);
        }

        .notification.info {
            background: var(--accent-info);
        }
    </style>
</head>
<body>
    <div class="performance-monitor" id="performance-monitor">FPS: 60 | Memory: Normal</div>

    <div class="container">
        <header class="game-header">
            <div class="logo">
                <h1>NationCraft Ultimate</h1>
                <span class="sr-only">Advanced Historical Country Building Simulator</span>
            </div>
            <div class="header-controls">
                <select id="timeline-select" class="btn btn-secondary btn-small">
                    <option value="WWII">World War II (1939-1945)</option>
                    <option value="ColdWar">Cold War (1947-1991)</option>
                    <option value="Modern">Modern Era (1991-Present)</option>
                </select>
                <select id="scenario-select" class="btn btn-secondary btn-small">
                    <option value="sandbox">Sandbox Mode</option>
                    <option value="historical">Historical Scenarios</option>
                    <option value="challenge">Challenge Mode</option>
                </select>
                <button id="save-btn" class="btn btn-secondary btn-small">üíæ Save</button>
                <button id="load-btn" class="btn btn-secondary btn-small">üìÇ Load</button>
                <button id="next-turn" class="btn btn-primary btn-small">Next Month ‚ñ∂</button>
            </div>
        </header>

        <div class="game-layout">
            <!-- Left Sidebar - Enhanced Stats -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>üá∫üá≥ Nation Overview</h3>
                    <div id="crisis-alerts"></div>
                    
                    <div class="stat">
                        <div class="stat-name">üí∞ Treasury</div>
                        <div class="stat-value" id="money-value">$1,000</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill money-fill" id="money-bar"></div>
                    </div>

                    <div class="stat">
                        <div class="stat-name">üë• Population</div>
                        <div class="stat-value" id="population-value">1.2M</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill population-fill" id="population-bar"></div>
                    </div>

                    <div class="stat">
                        <div class="stat-name">üî¨ Technology</div>
                        <div class="stat-value" id="tech-value">25</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill tech-fill" id="tech-bar"></div>
                    </div>

                    <div class="stat">
                        <div class="stat-name">‚öñÔ∏è Stability</div>
                        <div class="stat-value" id="stability-value">75%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill stability-fill" id="stability-bar"></div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>üåç Environment</h3>
                    <div id="environment-indicators">
                        <div class="environment-indicator">
                            <span>üå°Ô∏è Temperature</span>
                            <span id="temp-value">+0.8¬∞C</span>
                        </div>
                        <div class="environment-indicator">
                            <span>üíß Pollution</span>
                            <span id="pollution-value">25%</span>
                        </div>
                        <div class="environment-indicator">
                            <span>üåø Ecosystem</span>
                            <span id="eco-value">78%</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>üìä Population Demographics</h3>
                    <div class="population-chart">
                        <div class="chart-bar">
                            <div class="chart-label">Youth (0-18)</div>
                            <div class="chart-value">
                                <div class="chart-fill youth-fill" style="width: 30%"></div>
                            </div>
                            <span>30%</span>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Adults (19-65)</div>
                            <div class="chart-value">
                                <div class="chart-fill adult-fill" style="width: 55%"></div>
                            </div>
                            <span>55%</span>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Elderly (65+)</div>
                            <div class="chart-value">
                                <div class="chart-fill elderly-fill" style="width: 15%"></div>
                            </div>
                            <span>15%</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content - Enhanced Tabs -->
            <main class="main-content">
                <div class="tab-system">
                    <div class="tab-header">
                        <button class="tab-button active" data-tab="government">üèõÔ∏è Government</button>
                        <button class="tab-button" data-tab="economy">üíº Economy</button>
                        <button class="tab-button" data-tab="technology">üî¨ Technology</button>
                        <button class="tab-button" data-tab="military">‚öîÔ∏è Military</button>
                        <button class="tab-button" data-tab="espionage">üïµÔ∏è Espionage</button>
                        <button class="tab-button" data-tab="scenarios">üéØ Scenarios</button>
                    </div>

                    <!-- Government Tab -->
                    <div class="tab-content active" id="government-tab">
                        <h2>Government Management</h2>
                        <div class="action-panel">
                            <!-- Government actions will go here -->
                        </div>
                    </div>

                    <!-- Economy Tab -->
                    <div class="tab-content" id="economy-tab">
                        <h2>Economic Dashboard</h2>
                        <div class="economic-dashboard">
                            <div class="economic-indicator">
                                <div>GDP Growth</div>
                                <div class="economic-value">3.2%</div>
                                <div class="economic-trend trend-up">‚Üë +0.5%</div>
                            </div>
                            <div class="economic-indicator">
                                <div>Inflation</div>
                                <div class="economic-value">2.1%</div>
                                <div class="economic-trend trend-down">‚Üì -0.2%</div>
                            </div>
                            <div class="economic-indicator">
                                <div>Unemployment</div>
                                <div class="economic-value">5.4%</div>
                                <div class="economic-trend trend-up">‚Üë +0.3%</div>
                            </div>
                            <div class="economic-indicator">
                                <div>Trade Balance</div>
                                <div class="economic-value">+$2.1B</div>
                                <div class="economic-trend trend-up">‚Üë $0.3B</div>
                            </div>
                        </div>
                    </div>

                    <!-- Technology Tab -->
                    <div class="tab-content" id="technology-tab">
                        <h2>Research & Development</h2>
                        <div class="tech-tree" id="tech-tree">
                            <!-- Technology cards will be populated here -->
                        </div>
                    </div>

                    <!-- Military Tab -->
                    <div class="tab-content" id="military-tab">
                        <h2>Military Command</h2>
                        <div class="war-interface" id="war-interface">
                            <div class="battle-animation" id="battle-animation">
                                <!-- Battle animation will go here -->
                            </div>
                            <div class="war-stats">
                                <div>Military Power: <span id="military-power">15,000</span></div>
                                <div>Naval Capacity: <span id="naval-capacity">45/50</span></div>
                                <div>Air Superiority: <span id="air-superiority">72%</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Espionage Tab -->
                    <div class="tab-content" id="espionage-tab">
                        <h2>Intelligence Operations</h2>
                        <div class="espionage-missions" id="espionage-missions">
                            <!-- Mission cards will be populated here -->
                        </div>
                    </div>

                    <!-- Scenarios Tab -->
                    <div class="tab-content" id="scenarios-tab">
                        <h2>Historical Scenarios</h2>
                        <div class="scenario-grid" id="scenario-grid">
                            <!-- Scenario cards will be populated here -->
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar - Enhanced Dashboard -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>üåê World News</h3>
                    <div id="news-feed">
                        <div class="news-item">Global markets show positive trends</div>
                        <div class="news-item">International tensions rising</div>
                        <div class="news-item">Climate summit concludes</div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>ü§ù Diplomacy</h3>
                    <div id="diplomacy-status">
                        <div class="nation-item">
                            <span>United States</span>
                            <span class="status-ally">Ally</span>
                        </div>
                        <div class="nation-item">
                            <span>Germany</span>
                            <span class="status-neutral">Neutral</span>
                        </div>
                        <div class="nation-item">
                            <span>USSR</span>
                            <span class="status-enemy">Rival</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>‚ö†Ô∏è Active Crises</h3>
                    <div id="active-crises">
                        <div class="crisis-item">
                            <div>Economic Recession</div>
                            <div class="crisis-severity medium">Medium</div>
                        </div>
                        <div class="crisis-item">
                            <div>Border Tensions</div>
                            <div class="crisis-severity low">Low</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>üìà Research Progress</h3>
                    <div id="research-queue">
                        <div class="research-item">
                            <div>Nuclear Fission</div>
                            <div class="research-progress">65%</div>
                        </div>
                        <div class="research-item">
                            <div>Jet Propulsion</div>
                            <div class="research-progress">42%</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Enhanced Mobile Action Bar -->
    <div class="mobile-action-bar">
        <button id="mobile-save" class="btn btn-secondary btn-small">üíæ Save</button>
        <button id="mobile-next" class="btn btn-primary btn-small">Next Month ‚ñ∂</button>
        <button id="mobile-menu" class="btn btn-secondary btn-small">‚ò∞ Menu</button>
    </div>

    <!-- Enhanced Sound Controls -->
    <div class="sound-controls">
        <button id="sound-toggle" class="sound-toggle">üîä</button>
        <button id="music-toggle" class="sound-toggle">üéµ</button>
    </div>

    <!-- Enhanced Event Container -->
    <div class="event-container" id="event-container"></div>

    <!-- Enhanced Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Enhanced Game State with All New Systems
        const gameState = {
            // Core Systems
            money: 1000,
            population: 1200000,
            technology: 25,
            stability: 75,
            military: 100,
            
            // Enhanced Economic System
            economy: {
                gdp: 50000,
                inflation: 2.1,
                unemployment: 5.4,
                tradeBalance: 2100,
                stockMarket: {
                    values: { industrial: 100, tech: 150, energy: 80 },
                    trends: { industrial: 'up', tech: 'down', energy: 'stable' }
                }
            },
            
            // Enhanced Population System
            populationDetails: {
                demographics: {
                    youth: 0.3,
                    adult: 0.55,
                    elderly: 0.15
                },
                education: {
                    illiterate: 0.1,
                    basic: 0.4,
                    secondary: 0.3,
                    higher: 0.2
                },
                employment: {
                    agriculture: 0.2,
                    industry: 0.4,
                    services: 0.3,
                    unemployed: 0.1
                }
            },
            
            // Environmental System
            environment: {
                temperature: 0.8,
                pollution: 25,
                ecosystem: 78,
                resources: {
                    oil: { reserves: 50000, extraction: 1000 },
                    minerals: { reserves: 100000, extraction: 2000 },
                    renewable: 35
                }
            },
            
            // Crisis System
            crises: [
                { type: 'economic', severity: 'medium', duration: 3, impact: { money: -200, stability: -10 } },
                { type: 'border', severity: 'low', duration: 1, impact: { military: 50, stability: -5 } }
            ],
            
            // Technology Tree
            research: {
                queue: [
                    { id: 'nuclear', name: 'Nuclear Fission', progress: 65, cost: 2000 },
                    { id: 'jets', name: 'Jet Propulsion', progress: 42, cost: 1500 }
                ],
                unlocked: ['industrial_basic', 'military_basic'],
                available: ['nuclear', 'jets', 'computers', 'space']
            },
            
            // Espionage System
            espionage: {
                intelligence: 45,
                networks: {
                    'USA': { level: 2, agents: 3 },
                    'USSR': { level: 1, agents: 1 }
                },
                missions: [
                    { id: 'sabotage', name: 'Industrial Sabotage', risk: 'high', cost: 500 },
                    { id: 'intel', name: 'Gather Intelligence', risk: 'medium', cost: 300 }
                ]
            },
            
            // Scenario System
            currentScenario: 'sandbox',
            scenarioProgress: 0,
            
            // Enhanced War System
            militaryDetails: {
                power: 15000,
                navalCapacity: { current: 45, max: 50 },
                airSuperiority: 72,
                units: {
                    infantry: 10000,
                    tanks: 500,
                    aircraft: 200,
                    ships: 45
                }
            },
            
            // Performance Tracking
            performance: {
                fps: 60,
                memory: 'normal',
                lastUpdate: Date.now()
            }
        };

        // Initialize All Systems
        function initEnhancedGame() {
            setupEnhancedEventListeners();
            initTechnologyTree();
            initEspionageSystem();
            initScenarioSystem();
            initEnvironmentalSystem();
            initCrisisSystem();
            initPerformanceMonitor();
            updateEnhancedUI();
            
            showNotification('NationCraft Ultimate v2.0 Initialized!', 'success');
        }

        // Setup Enhanced Event Listeners
        function setupEnhancedEventListeners() {
            // Tab system
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Sound controls
            document.getElementById('sound-toggle').addEventListener('click', toggleSound);
            document.getElementById('music-toggle').addEventListener('click', toggleMusic);

            // Scenario system
            document.getElementById('scenario-select').addEventListener('change', (e) => {
                gameState.currentScenario = e.target.value;
                loadScenario(gameState.currentScenario);
            });

            // Performance monitoring
            setInterval(updatePerformanceMonitor, 1000);
        }

        // Initialize Technology Tree
        function initTechnologyTree() {
            const techTree = document.getElementById('tech-tree');
            const technologies = [
                { id: 'nuclear', name: 'Nuclear Fission', cost: 2000, era: 'WWII', category: 'science' },
                { id: 'jets', name: 'Jet Propulsion', cost: 1500, era: 'WWII', category: 'military' },
                { id: 'computers', name: 'Digital Computers', cost: 3000, era: 'ColdWar', category: 'science' },
                { id: 'space', name: 'Space Program', cost: 5000, era: 'ColdWar', category: 'science' }
            ];

            technologies.forEach(tech => {
                const techCard = document.createElement('div');
                techCard.className = 'tech-card';
                techCard.innerHTML = `
                    <h4>${tech.name}</h4>
                    <p>Research cost: $${tech.cost}</p>
                    <div class="tech-cost">
                        <span>${tech.era}</span>
                        <span>${tech.category}</span>
                    </div>
                `;
                techTree.appendChild(techCard);
            });
        }

        // Initialize Espionage System
        function initEspionageSystem() {
            const missionsContainer = document.getElementById('espionage-missions');
            const missions = [
                { id: 'sabotage', name: 'Industrial Sabotage', risk: 'high', cost: 500, effect: 'Reduce enemy production' },
                { id: 'intel', name: 'Gather Intelligence', risk: 'medium', cost: 300, effect: 'Gain military secrets' },
                { id: 'propaganda', name: 'Propaganda Campaign', risk: 'low', cost: 200, effect: 'Reduce enemy stability' }
            ];

            missions.forEach(mission => {
                const missionCard = document.createElement('div');
                missionCard.className = 'mission-card';
                missionCard.innerHTML = `
                    <h4>${mission.name}</h4>
                    <p>${mission.effect}</p>
                    <div class="mission-risk risk-${mission.risk}">${mission.risk.toUpperCase()} RISK</div>
                    <button class="btn btn-secondary btn-small" onclick="executeMission('${mission.id}')">Execute ($${mission.cost})</button>
                `;
                missionsContainer.appendChild(missionCard);
            });
        }

        // Initialize Scenario System
        function initScenarioSystem() {
            const scenarioGrid = document.getElementById('scenario-grid');
            const scenarios = [
                { id: 'ww2_start', name: 'WWII Outbreak', difficulty: 'medium', description: 'Start at the beginning of WWII with limited resources' },
                { id: 'coldwar_begin', name: 'Cold War Start', difficulty: 'hard', description: 'Navigate the tense early years of the Cold War' },
                { id: 'modern_crisis', name: 'Modern Crisis', difficulty: 'easy', description: 'Manage a contemporary global crisis' }
            ];

            scenarios.forEach(scenario => {
                const scenarioCard = document.createElement('div');
                scenarioCard.className = 'scenario-card';
                scenarioCard.innerHTML = `
                    <h4>${scenario.name}</h4>
                    <p>${scenario.description}</p>
                    <div class="scenario-difficulty difficulty-${scenario.difficulty}">${scenario.difficulty.toUpperCase()}</div>
                    <button class="btn btn-primary btn-small" onclick="loadScenario('${scenario.id}')">Start Scenario</button>
                `;
                scenarioGrid.appendChild(scenarioCard);
            });
        }

        // Initialize Environmental System
        function initEnvironmentalSystem() {
            // Environmental effects will be processed each turn
            setInterval(processEnvironmentalEffects, 5000);
        }

        // Initialize Crisis System
        function initCrisisSystem() {
            // Random crisis generation
            setInterval(generateRandomCrisis, 30000);
        }

        // Initialize Performance Monitor
        function initPerformanceMonitor() {
            // Track FPS and memory usage
            let frameCount = 0;
            let lastTime = performance.now();
            
            function checkPerformance() {
                frameCount++;
                const currentTime = performance.now();
                if (currentTime >= lastTime + 1000) {
                    const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                    gameState.performance.fps = fps;
                    frameCount = 0;
                    lastTime = currentTime;
                }
                requestAnimationFrame(checkPerformance);
            }
            checkPerformance();
        }

        // Enhanced UI Update Function
        function updateEnhancedUI() {
            // Update all UI elements with current game state
            updateEconomicDashboard();
            updateEnvironmentalIndicators();
            updatePopulationCharts();
            updateCrisisAlerts();
            updatePerformanceMonitor();
        }

        // System Functions
        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Activate selected tab
            document.getElementById(`${tabId}-tab`).classList.add('active');
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        }

        function executeMission(missionId) {
            const mission = gameState.espionage.missions.find(m => m.id === missionId);
            if (gameState.money >= mission.cost) {
                gameState.money -= mission.cost;
                // Mission logic here
                showNotification(`Espionage mission executed: ${mission.name}`, 'info');
                updateEnhancedUI();
            } else {
                showNotification('Not enough funds for espionage mission', 'error');
            }
        }

        function loadScenario(scenarioId) {
            gameState.currentScenario = scenarioId;
            // Load scenario-specific conditions
            showNotification(`Scenario loaded: ${scenarioId}`, 'success');
            updateEnhancedUI();
        }

        function processEnvironmentalEffects() {
            // Process environmental changes
            if (gameState.environment.pollution > 50) {
                gameState.stability -= 2;
                gameState.populationDetails.demographics.elderly += 0.01;
            }
            
            if (gameState.environment.temperature > 2.0) {
                // Climate change effects
                generateCrisis('environmental', 'high');
            }
            
            updateEnhancedUI();
        }

        function generateRandomCrisis() {
            const crisisTypes = ['economic', 'political', 'environmental', 'military'];
            const randomType = crisisTypes[Math.floor(Math.random() * crisisTypes.length)];
            const severity = Math.random() > 0.7 ? 'high' : Math.random() > 0.4 ? 'medium' : 'low';
            
            generateCrisis(randomType, severity);
        }

        function generateCrisis(type, severity) {
            const crisis = {
                type: type,
                severity: severity,
                duration: severity === 'high' ? 5 : severity === 'medium' ? 3 : 1,
                impact: {}
            };
            
            gameState.crises.push(crisis);
            showNotification(`Crisis Alert: ${type} crisis (${severity} severity)`, 'warning');
            updateEnhancedUI();
        }

        function updatePerformanceMonitor() {
            const monitor = document.getElementById('performance-monitor');
            monitor.textContent = `FPS: ${gameState.performance.fps} | Memory: ${gameState.performance.memory}`;
        }

        function toggleSound() {
            // Sound toggle logic
            showNotification('Sound effects toggled', 'info');
        }

        function toggleMusic() {
            // Music toggle logic
            showNotification('Background music toggled', 'info');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize the enhanced game when page loads
        window.addEventListener('DOMContentLoaded', initEnhancedGame);
    </script>
</body>
</html>
